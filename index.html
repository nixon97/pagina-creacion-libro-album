<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma Libro Álbum Digital</title>
              <button onClick={(e) => { e.stopPropagation(); deleteBookLocal(b.id); }} className="text-gray-400 hover:text-red-500"><i className="fas fa-trash"></i></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                                ))}
                            </div>
                            
                            <hr />
                            
                            {/* FORMULARIO */}
                            <div>
                                <h4 className="text-sm font-bold mb-2">Editar Contenido</h4>
                                <div className="flex bg-gray-100 p-1 rounded mb-3">
                                    <button onClick={()=>setEditSide('front')} className={`flex-1 text-xs py-1 rounded ${editSide==='front'?'bg-white shadow text-amber-800':''}`}>Anverso</button>
                                    <button onClick={()=>setEditSide('back')} className={`flex-1 text-xs py-1 rounded ${editSide==='back'?'bg-white shadow text-amber-800':''}`}>Reverso</button>
                                </div>
                                {(() => {
                                    const face = book.pages[selPageIdx][editSide];
                                    return (
                                        <div className="space-y-2 text-sm">
                                            <div>
                                                <label className="text-xs text-gray-500">Tipo</label>
                                                <select className="w-full border rounded p-1" value={face.type} onChange={e=>updateFace(selPageIdx, editSide, 'type', e.target.value)}>
                                                    <option value="image-page">Imagen</option>
                                                    <option value="text-page">Texto</option>
                                                    <option value="endpaper">Guardas</option>
                                                </select>
                                            </div>
                                            {face.type === 'image-page' && (
                                                <div>
                                                    <label className="text-xs text-gray-500">URL Imagen</label>
                                                    <input className="w-full border rounded p-1" value={face.bg||''} onChange={e=>updateFace(selPageIdx, editSide, 'bg', e.target.value)} placeholder="http://..." />
                                                </div>
                                            )}
                                            {face.type === 'text-page' && (
                                                <>
                                                    <input className="w-full border rounded p-1 mb-1" placeholder="Título" value={face.title||''} onChange={e=>updateFace(selPageIdx, editSide, 'title', e.target.value)} />
                                                    <textarea className="w-full border rounded p-1" rows="3" placeholder="Texto..." value={face.text||''} onChange={e=>updateFace(selPageIdx, editSide, 'text', e.target.value)} />
                                                </>
                                            )}
                                            <input className="w-full border rounded p-1 mt-1" placeholder="Tooltip / Ayuda" value={face.tooltip||''} onChange={e=>updateFace(selPageIdx, editSide, 'tooltip', e.target.value)} />
                                        </div>
                                    )
                                })()}
                            </div>
                        </div>
                    </div>

                    {/* VISOR 3D */}
                    <div className="flex-1 bg-gray-200 relative flex flex-col overflow-hidden">
                        <BookViewer pages={book.pages} activeIdx={activeIdx} />
                        
                        <div className="h-16 bg-white border-t flex justify-center items-center gap-8 z-30">
                            <button disabled={activeIdx<=0} onClick={()=>setActiveIdx(activeIdx-1)} className="p-2 rounded-full hover:bg-gray-100 disabled:opacity-30"><i className="fas fa-chevron-left text-xl"></i></button>
                            <span className="text-sm font-mono text-gray-400">Spread {activeIdx+1}</span>
                            <button disabled={activeIdx>=book.pages.length-1} onClick={()=>setActiveIdx(activeIdx+1)} className="p-2 rounded-full hover:bg-gray-100 disabled:opacity-30"><i className="fas fa-chevron-right text-xl"></i></button>
                        </div>
                    </div>
                </div>
            );
        }

        // --- VISOR 3D ---
        function BookViewer({ pages, activeIdx }) {
            const isOpen = activeIdx >= 0 && activeIdx < pages.length - 1;
            const isClosedBack = activeIdx === pages.length - 1;
            const bookClass = `book-3d ${isOpen ? 'opened' : ''} ${isClosedBack ? 'closed-back' : ''}`;

            return (
                <div className="stage-container">
                    <div className={bookClass}>
                        {pages.map((p, i) => {
                            const zIndex = activeIdx >= i ? i + 1 : pages.length - i;
                            return (
                                <div key={p.id} className={`paper ${i <= activeIdx ? 'flipped' : ''}`} style={{ zIndex }}>
                                    <div className={`face front ${p.front.type}`} style={p.front.bg ? { backgroundImage: `url(${p.front.bg})` } : {}}>
                                        {p.front.type === 'text-page' && <div className="text-center"><h2>{p.front.title}</h2><p>{p.front.text}</p></div>}
                                    </div>
                                    <div className={`face back ${p.back.type}`} style={p.back.bg ? { backgroundImage: `url(${p.back.bg})` } : {}}>
                                        {p.back.type === 'text-page' && <div className="text-center"><h2>{p.back.title}</h2><p>{p.back.text}</p></div>}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    {/* Tooltips */}
                    <div className="absolute inset-0 pointer-events-none flex justify-between px-10 pb-20 items-end z-40">
                         <div className={`bg-white p-3 rounded shadow transition-opacity duration-500 ${activeIdx>=0 && pages[activeIdx]?.back?.tooltip ? 'opacity-100' : 'opacity-0'}`}>
                            <h3 className="text-amber-800 font-bold font-serif">{pages[activeIdx]?.back?.tooltip}</h3>
                         </div>
                         <div className={`bg-white p-3 rounded shadow transition-opacity duration-500 ${activeIdx+1<pages.length && pages[activeIdx+1]?.front?.tooltip ? 'opacity-100' : 'opacity-0'}`}>
                            <h3 className="text-amber-800 font-bold font-serif">{pages[activeIdx+1]?.front?.tooltip}</h3>
                         </div>
                    </div>
                </div>
            )
        }

        // RENDERIZADO
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
